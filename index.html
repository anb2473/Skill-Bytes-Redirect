<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Connecting...</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
                    sans-serif;
                background: #000;
                color: #fff;
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .card {
                background: #000;
                border: 2px solid #fff;
                border-radius: 8px;
                padding: 40px;
                max-width: 500px;
                width: 100%;
                text-align: center;
            }

            .spinner {
                width: 48px;
                height: 48px;
                border: 3px solid #fff;
                border-top-color: transparent;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 30px;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            h1 {
                font-size: 24px;
                margin-bottom: 15px;
                font-weight: 600;
            }

            .message {
                font-size: 14px;
                opacity: 0.8;
                line-height: 1.5;
            }

            .url-display {
                margin-top: 25px;
                padding: 15px;
                background: #000;
                border: 1px solid #fff;
                border-radius: 6px;
                font-family: monospace;
                font-size: 12px;
                text-align: left;
                word-break: break-all;
            }

            .url-line {
                margin: 8px 0;
            }

            .url-label {
                opacity: 0.6;
                margin-right: 8px;
            }
        </style>
    </head>
    <body>
        <div class="card">
            <div class="spinner" id="spinner"></div>
            <h1 id="title">Connecting...</h1>
            <p class="message" id="message">Checking server status...</p>
            <div id="urls" class="url-display" style="display: none"></div>
        </div>

        <script>
            async function checkAndRedirect() {
                var titleEl = document.getElementById("title");
                var messageEl = document.getElementById("message");
                var urlsEl = document.getElementById("urls");
                var spinnerEl = document.getElementById("spinner");

                try {
                    var configData = await fetch("./redirect.json");
                    var config = await configData.json();

                    if (!config.primary_url || !config.fallback_url) {
                        spinnerEl.style.display = "none";
                        titleEl.textContent = "Configuration Error";
                        messageEl.textContent =
                            "redirect.json must contain primary_url and fallback_url";
                        return;
                    }

                    urlsEl.innerHTML =
                        '<div class="url-line"><span class="url-label">Primary:</span>' +
                        config.primary_url +
                        '</div><div class="url-line"><span class="url-label">Fallback:</span>' +
                        config.fallback_url +
                        "</div>";
                    urlsEl.style.display = "block";

                    messageEl.textContent =
                        "Pinging " + config.primary_url + "...";

                    try {
                        var controller = new AbortController();
                        var timeoutId = setTimeout(function () {
                            controller.abort();
                        }, 5000);

                        await fetch(config.primary_url, {
                            method: "HEAD",
                            mode: "no-cors",
                            signal: controller.signal,
                        });

                        clearTimeout(timeoutId);

                        titleEl.textContent = "Connected";
                        messageEl.textContent =
                            "Redirecting to primary server...";
                        setTimeout(function () {
                            window.location.href = config.primary_url;
                        }, 800);
                    } catch (error) {
                        titleEl.textContent = "Using Fallback";
                        messageEl.textContent =
                            "Primary unavailable. Redirecting to fallback...";
                        setTimeout(function () {
                            window.location.href = config.fallback_url;
                        }, 800);
                    }
                } catch (error) {
                    spinnerEl.style.display = "none";
                    titleEl.textContent = "Error";
                    messageEl.textContent =
                        "Failed to load configuration: " + error.message;
                }
            }

            checkAndRedirect();
        </script>
    </body>
</html>
